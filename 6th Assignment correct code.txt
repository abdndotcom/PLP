import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Load the dataset
df = pd.read_csv(r'C:\Users\user\Desktop\2025\PLP\Python\DataSet\Online Retail.csv')  # Use .csv for this task

# Display first 5 rows
print("First 5 rows of the dataset:")
print(df.head())

# Display dataset info
print("\nDataset Information:")
print(df.info())

# Check data types
print("\nData types of each column:")
print(df.dtypes)

# Check missing values
missing_values_count = df.isnull().sum()
print("\nNumber of missing values per column:")
print(missing_values_count)

# Percentage of missing values
total_rows = len(df)
missing_percentage = (missing_values_count / total_rows) * 100
print("\nPercentage of missing values per column:")
print(missing_percentage)

# Drop rows with missing values (or use df.fillna() as an alternative)
df_cleaned = df.dropna()
print("\nDataset shape after dropping missing values:", df_cleaned.shape)

# Task 2: Basic Data Analysis
print("\nBasic Statistics:")
print(df_cleaned.describe())

# Group by a categorical column (example: 'Country') and compute mean of 'UnitPrice'
if 'Country' in df_cleaned.columns and 'UnitPrice' in df_cleaned.columns:
    country_group = df_cleaned.groupby('Country')['UnitPrice'].mean().sort_values(ascending=False)
    print("\nAverage Unit Price per Country:")
    print(country_group)

# Task 3: Data Visualization

# Line chart: Quantity over time
if 'InvoiceDate' in df_cleaned.columns and 'Quantity' in df_cleaned.columns:
    df_cleaned['InvoiceDate'] = pd.to_datetime(df_cleaned['InvoiceDate'])
    time_series = df_cleaned.groupby('InvoiceDate')['Quantity'].sum()
    plt.figure(figsize=(12, 6))
    time_series.plot()
    plt.title('Quantity Sold Over Time')
    plt.xlabel('Date')
    plt.ylabel('Quantity')
    plt.grid(True)
    plt.show()

# Bar chart: Average UnitPrice per Country
if 'Country' in df_cleaned.columns and 'UnitPrice' in df_cleaned.columns:
    top_countries = df_cleaned.groupby('Country')['UnitPrice'].mean().sort_values(ascending=False).head(10)
    plt.figure(figsize=(10, 6))
    sns.barplot(x=top_countries.values, y=top_countries.index)
    plt.title('Top 10 Countries by Average Unit Price')
    plt.xlabel('Average Unit Price')
    plt.ylabel('Country')
    plt.show()

# Histogram: Distribution of UnitPrice
if 'UnitPrice' in df_cleaned.columns:
    plt.figure(figsize=(8, 5))
    sns.histplot(df_cleaned['UnitPrice'], bins=50, kde=True)
    plt.title('Distribution of Unit Price')
    plt.xlabel('Unit Price')
    plt.ylabel('Frequency')
    plt.show()

# Scatter plot: Quantity vs UnitPrice
if 'Quantity' in df_cleaned.columns and 'UnitPrice' in df_cleaned.columns:
    plt.figure(figsize=(8, 6))
    sns.scatterplot(x='Quantity', y='UnitPrice', data=df_cleaned)
    plt.title('Scatter Plot: Quantity vs Unit Price')
    plt.xlabel('Quantity')
    plt.ylabel('Unit Price')
    plt.show()
